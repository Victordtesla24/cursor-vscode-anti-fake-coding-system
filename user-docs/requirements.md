## Raw Requirements

1. Update the shell scripts to create all the `.mdc` files in `~/Library/Application Support/Cursor/rules/` directory - create the `~/.cursor/rules/` directory in both global location and project directory if it doesn't exist and ensure all the `.mdc` files are `PROJECT AGNOSTIC` and are created using embedded content from template files located at `user-docs/temp-rule-templates/` relative to git repository root.

2. Update all the shell scripts mentioned below, by removing `path` and `project` specific executions - ensuring all the shell scripts are project and path agnostic using `pwd` and git root detection to work from any cloned repository location - where these scripts can be cloned from the git repository (`git clone https://github.com/Victordtesla24/cursor-vscode-anti-fake-coding-system.git`) and all the settings, configurations, policy files must be created, implemented, tested and applied to the VSCode IDE ensuring `ZERO` Fake/Mocked-up code is `EVER` generated by the AI/AI Editors within this VSCode IDE:
    - `ai-extension-settings.sh`
    - `cursor-application-settings.sh`
    - `cursor-optimization-policies.sh`
    - `policy-file-generator.sh`
    - `test-anti-fake-validation.sh`

3. Update the shell scripts mentioned above, by modifying the logic where the configurations, settings and policy implementation and adherence to the policy documents (`.mdc`) is separated - one for `GLOBAL` and other for extension `SPECIFIC`, for example `Cline AI Extensions`. 
   - There must be a clear distinction between implementing and applying these policies - and must be carefully configured to ensure `Cline AI Extension` Specific Policies ***are not*** applied `Globally`
   - The `Extension Specific` Policy documents - in this case `Cline AI`, must be saved in `.clinerules/` directory in Default (`~/Library/Application Support/Cursor/.clinerules/`) and Project Directory (`./.clinerules/`) respectively
   - The `Extension Specific` Policy documents - in this case `Cline AI`, must be saved with `.md` file extension compared to `Global` Policy documents saved with `.mdc` file extensions
   - **CRITICAL**: If `Cline AI` extension is NOT installed, `.clinerules/` directory must NOT be created at all
   - The `Extension Specific` Policy documents - in this case `Cline AI`, there must be tests that verify and validate clear separation of Policy File creations, their locations, their extensions, their implementation and application is `SEPARATE` to the `GLOBAL` Policy File creations

   **IMPORTANT NOTES** 
    1. The Global Policy Files reside in `~/Library/Application Support/Cursor/rules/`
    2. The Extension Specific Files reside in `~/Library/Application Support/Cursor/.clinerules/` (only if extension detected)
    3. Extension isolation achieved through separate scripts and distinct directory structures

4. Update the shell scripts and update the Policy File creations, their locations, their extensions, their implementation and application to ensure the above requirements are accurately and precisely implemented with the following changes:
  - Remove `001-coding-protocols.mdc` and `004-token-optimization.mdc` from **GLOBAL POLICY** File creations, their locations, their extensions, their implementation and application
  - Update the **EXTENSION SPECIFIC** Policy File creations, their locations, their extensions, their implementation and application logic by using the following instructions:
    - The script must ensure content in `.clinerules/001-cline-coding-protocols.md` contains the extracted coding protocols content and is saved as `.md` and **NOT** `.mdc`
    - The script must ensure content in `.clinerules/002-token-optimization.md` contains the extracted token optimization content and is saved as `.md` and **NOT** `.mdc`

5. Update the `policy-file-generator.sh` shell script, by modifying the logic that creates policy files, ensuring the global Policy files are created in all the correct locations, naming conventions, and `SPECIFIC` contents exactly `as-is` from the following source files using **EMBEDDED CONTENT** (heredoc or base64 encoding) for complete project portability:
   - `.cursorrules` must be created with the exact `as-is` contents from `user-docs/temp-rule-templates/my-cursorrules.md` embedded in script
   - `001-directory-management-protocols.mdc` global policy file must be:
      - created & saved in `~/Library/Application Support/Cursor/rules/` and `./.cursor/rules/` directories
      - must have exact `as-is` contents from `user-docs/temp-rule-templates/my-directory-management-protocols.md` embedded in script
   - `002-error-fixing-protocols.mdc` global policy file must be:
      - created & saved in `~/Library/Application Support/Cursor/rules/` and `./.cursor/rules/` directories
      - must have exact `as-is` contents from `user-docs/temp-rule-templates/my-error-fixing-protocols.md` embedded in script
   - `003-backend_structure_document.mdc` global policy file must be:
      - created & saved in `~/Library/Application Support/Cursor/rules/` and `./.cursor/rules/` directories
      - keep current embedded content (no external dependency)
   - `004-tech_stack_document.mdc` global policy file must be:
      - created & saved in `~/Library/Application Support/Cursor/rules/` and `./.cursor/rules/` directories
      - keep current embedded content (no external dependency)

6. Update the `policy-file-generator.sh` script, to ensure **ONLY** `.cursorrules` exists with **TWO DISTINCT CHAPTERS**: 
   - **Chapter 1**: Global Cursor AI Rules (from embedded `my-cursorrules.md` content)
   - **Chapter 2**: Project-Specific Rules (from embedded `cursor_project_rules.md` content)
   - **ELIMINATE**: Separate `cursor_project_rules.md` file completely after merging into `.cursorrules`
   - **ENSURE**: Other rule files (`.gitignore`, `.cursorignore`) remain unaffected

7. Create/Update & Run tests to effectively and precisely verify and validate **every single requirement** above - providing `file paths` for every Global and Extension Specific Policy document created (in default and in the Project Directory). Tests must verify **complete functionality implementation** from Raw Requirements, ensuring no requirement is missed, mis-interpreted, or impacts other functionalities.

8. Remove all duplicate, redundant files from the codebase from the above steps, after moving, renaming respective policy files in their correct locations and with correct extensions. **Example**: When `.cursor/rules/001-directory-management-protocols.mdc` is created, any existing `002-directory-management.mdc` files become duplicates and must be removed. Ensure all **INSTRUCTIONS** from embedded `my-directory-management-protocols.md` protocols are followed **METICULOUSLY** (with no ***duplicate*** file creation).

------

## Refined Prompt from the Raw Requirements

# **Refined Cursor AI GPT Prompt: Shell Script Enhancement for Project-Agnostic Anti-Fake Code System**

## **Objective**
Transform the existing Cursor AI hardening shell scripts into completely project-agnostic, production-ready tools that enforce **ZERO fake code policies** across all VSCode/Cursor environments. The solution must work from any git clone location using embedded content for complete portability.

## **Core Requirements**

### 1. **Complete Project-Agnostic Transformation with Embedded Content**
Update the following shell scripts to work from **ANY** git clone location:
- `ai-extension-settings.sh`
- `cursor-application-settings.sh` 
- `cursor-optimization-policies.sh`
- `policy-file-generator.sh`
- `test-anti-fake-validation.sh`

**Required Implementation Strategy:**
- **Embed template content** directly in scripts using [heredoc or base64 encoding](https://blog.tratif.com/2023/02/17/bash-tips-6-embedding-files-in-a-single-bash-script/) techniques
- **Remove ALL** external file dependencies from `user-docs/temp-rule-templates/`
- **Implement** dynamic path detection using `pwd` and git root detection
- **Ensure** scripts work when repository is cloned to any location: `git clone https://github.com/Victordtesla24/cursor-vscode-anti-fake-coding-system.git`
- **Support** scenario: `chmod +x master-cursor-hardening.sh && ./master-cursor-hardening.sh`

### 2. **Dual-Location Policy File Creation with Correct Default Paths**
Create policy files in **both** locations using the macOS default directory structure:
- **Global**: `~/Library/Application Support/Cursor/rules/` directory (auto-create if missing)
- **Project**: `./.cursor/rules/` directory within current project (auto-create if missing)

**Correct Directory Structure:**
```bash
├── ~/Library/Application Support/Cursor/rules/     # Global policies (macOS default)
│   ├── 001-directory-management-protocols.mdc
│   ├── 002-error-fixing-protocols.mdc
│   ├── 003-backend_structure_document.mdc
│   └── 004-tech_stack_document.mdc
└── $PROJECT_ROOT/.cursor/rules/                    # Project-specific policies
    └── [same files as global]
```

### 3. **Strict Extension-Specific vs Global Policy Separation**
**CRITICAL ISOLATION REQUIREMENT**: Create complete separation between global and extension-specific policies:

**Cline AI Extension Detection Logic:**
```bash
# ONLY create .clinerules if Cline extension is detected
if code --list-extensions 2>/dev/null | grep -q "saoudrizwan.claude-dev"; then
    # Create Cline-specific policies in .clinerules/
    # Use .md extension for ALL extension-specific files
else
    # Do NOT create .clinerules directory at all
fi
```

**Extension-Specific Requirements:**
- **Create** `.clinerules/` directory ONLY when Cline AI extension is detected
- **Do NOT create** `.clinerules/` if Cline extension is not installed
- **Remove** from global policies: `001-coding-protocols.mdc` and `004-token-optimization.mdc`
- **Generate** Cline-specific files with `.md` extension consistently:
  - `.clinerules/001-cline-coding-protocols.md`
  - `.clinerules/002-token-optimization.md`
- **Ensure** extension policies are NEVER applied to global VSCode settings
- **Implement** separation through distinct directory structures and separate scripts

### 4. **Embedded Content Strategy for Complete Portability**
Implement content embedding using [heredoc best practices](https://phoenixnap.com/kb/bash-heredoc):

**Template Content Embedding Methods:**
```bash
# Method 1: Heredoc with embedded content
create_cursorrules() {
    cat > .cursorrules << 'EOF'
[Embedded content from my-cursorrules.md]
EOF
}

# Method 2: Base64 encoded content (for binary or complex content)
create_policy_file() {
    base64 -d > "$target_file" << 'EOF'
[Base64 encoded content]
EOF
}
```

**Content Mapping for Embedded Implementation:**
| **Target File** | **Embedded Source** | **Target Location** | **Extension** |
|---|---|---|---|
| `.cursorrules` | Embedded `my-cursorrules.md` content | Project root | N/A |
| `001-directory-management-protocols.mdc` | Embedded `my-directory-management-protocols.md` | Both global & project `.cursor/rules/` | `.mdc` |
| `002-error-fixing-protocols.mdc` | Embedded `my-error-fixing-protocols.md` | Both global & project `.cursor/rules/` | `.mdc` |
| `003-backend_structure_document.mdc` | Keep current embedded content | Both global & project `.cursor/rules/` | `.mdc` |
| `004-tech_stack_document.mdc` | Keep current embedded content | Both global & project `.cursor/rules/` | `.mdc` |
| `001-cline-coding-protocols.md` | Embedded extracted coding protocols | `.clinerules/` (if Cline detected) | `.md` |
| `002-token-optimization.md` | Embedded extracted token optimization | `.clinerules/` (if Cline detected) | `.md` |

### 5. **Single Consolidated .cursorrules with Embedded Dual Sections**
**Merge Strategy**: Create ONLY `.cursorrules` file with embedded content:

**Required Structure using Heredoc:**
```bash
create_consolidated_cursorrules() {
    cat > .cursorrules << 'EOF'
# Global Cursor AI Rules
[Embedded exact content from my-cursorrules.md]

---

# Project-Specific Rules  
[Embedded exact content from cursor_project_rules.md]
EOF
}
```

**Implementation Requirements:**
- **Eliminate** separate `cursor_project_rules.md` file completely
- **Preserve** all content from both sources using embedded heredoc
- **Maintain** clear section separation with markdown headers
- **Ensure** only `.cursorrules` exists, other files like `.gitignore`, `.cursorignore` remain unaffected

### 6. **Comprehensive Functionality Validation Testing**
Update `test-anti-fake-validation.sh` to verify **every single requirement** from Raw Requirements:

**Global Policy Verification:**
- ✅ All `.mdc` files exist in `~/Library/Application Support/Cursor/rules/` with correct names
- ✅ All `.mdc` files exist in `./.cursor/rules/` with identical embedded content
- ✅ Content matches embedded template sources exactly
- ✅ No fake code patterns detected in any file

**Project Policy Verification:**
- ✅ ONLY `.cursorrules` exists with both global and project sections
- ✅ NO separate `cursor_project_rules.md` file remains
- ✅ Content sourced from embedded templates

**Extension-Specific Verification:**
- ✅ `.clinerules/` directory exists ONLY if Cline extension detected
- ✅ If Cline not installed, NO `.clinerules/` directory created
- ✅ Cline AI policies exist in `.clinerules/` with `.md` extension consistently
- ✅ Global policies exclude Cline-specific content completely

**Complete Portability Verification:**
- ✅ All scripts execute successfully from any git clone location
- ✅ No external template file dependencies remain
- ✅ Embedded content creates identical policy files regardless of clone location
- ✅ `git clone` + `chmod +x master-cursor-hardening.sh && ./master-cursor-hardening.sh` works from scratch

### 7. **Mandatory Directory Management Compliance with Embedded Content**
**STRICT REQUIREMENTS** following embedded directory management protocols:

**Pre-Execution Duplicate Detection:**
- **Identify** files that become redundant after embedded content restructuring
- **Example**: When creating embedded `.cursor/rules/001-directory-management-protocols.mdc`, remove existing `002-directory-management.mdc`
- **Scan** for any remaining external template dependencies

**Embedded Content Implementation:**
- **No external file reads** - all content embedded in scripts using heredoc/base64
- **Atomic operations** - create backups before any file modifications  
- **Verify** embedded content accuracy matches original templates
- **Log** all file operations with full paths

**Post-Execution Cleanup:**
- **Remove** all duplicate files and external dependencies
- **Verify** no external template file references remain
- **Confirm** complete portability - scripts work from any clone location

## **Technical Implementation Requirements**

### **Embedded Content Strategy**
- **Heredoc Implementation**: Use `cat << 'EOF'` for exact content preservation
- **Base64 Encoding**: For complex content requiring binary safety
- **No External Dependencies**: Zero reliance on external template files
- **Content Verification**: Embedded content must match original templates exactly

### **Path Resolution & Compatibility**
- **Dynamic Git Root Detection**: Use `git rev-parse --show-toplevel` for repository root
- **PWD-Based Paths**: Use `pwd` and relative path detection
- **Cross-Platform Paths**: Handle macOS default directory structure correctly
- **Permission Handling**: Graceful handling of permission issues

### **Error Handling & Portability**
- **Idempotent Operations**: All scripts safe to run multiple times from any location
- **Embedded Content Validation**: Verify embedded content integrity
- **No External File Dependencies**: Complete elimination of template file dependencies
- **Clone Location Independence**: Work from any `git clone` destination

## **Success Criteria Checklist**

1. ✅ **Complete Clone Portability**: Scripts work from any `git clone https://github.com/Victordtesla24/cursor-vscode-anti-fake-coding-system.git` location
2. ✅ **Embedded Content Implementation**: All template content embedded using heredoc/base64
3. ✅ **Correct Default Locations**: Policy files created in `~/Library/Application Support/Cursor/rules/` and `./.cursor/rules/`
4. ✅ **Conditional Extension Creation**: `.clinerules/` created ONLY if Cline extension detected
5. ✅ **Consistent Extension Usage**: ALL extension-specific files use `.md` extension
6. ✅ **Perfect Extension Isolation**: Extension policies never contaminate global settings
7. ✅ **Single Consolidated Rules**: ONLY `.cursorrules` exists with embedded dual sections
8. ✅ **Zero External Dependencies**: No external template file dependencies remain
9. ✅ **Zero Duplicates**: All redundant files removed following embedded directory management protocols
10. ✅ **100% Requirements Coverage**: Every Raw Requirement implemented using embedded content
11. ✅ **Absolute Zero Fake Code**: Anti-fake code enforcement active across all environments
12. ✅ **Scratch Setup Success**: `chmod +x master-cursor-hardening.sh && ./master-cursor-hardening.sh` works from fresh clone